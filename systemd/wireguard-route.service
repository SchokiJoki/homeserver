[Unit]
Description=WireGuard Route
After=network-online.target docker.service
Wants=network-online.target docker.service

[Service]
Type=oneshot
ExecStart=/bin/bash -c 'for i in {1..12}; do if ping -c1 -W1 10.42.42.42 >/dev/null 2>&1; then /usr/sbin/ip route replace 10.8.0.0/24 via 10.42.42.42 && exit 0; fi; sleep 5; done; echo "wireguard container at 10.42.42.42 not reachable" >&2; exit 1'
ExecStop=/usr/sbin/ip route del 10.8.0.0/24 via 10.42.42.42 || true
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target
